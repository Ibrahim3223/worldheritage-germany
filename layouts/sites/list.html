{{ define "main" }}

<div class="bg-white" x-data="{
  selectedCategory: '',
  selectedRegion: '',
  selectedUNESCO: '',
  searchQuery: ''
}">

  <!-- Page Header -->
  <div class="bg-gradient-to-br from-forest-700 to-forest-900 text-white py-16 md:py-20">
    <div class="container-custom">
      <h1 class="text-3xl md:text-5xl font-serif font-bold text-white mb-4">
        Heritage Sites
      </h1>
      {{ $allSites := where .Site.RegularPages "Section" "sites" }}
      <p class="text-lg text-sage-200 max-w-3xl">
        Explore all {{ len $allSites }} heritage sites across Germany
      </p>
    </div>
  </div>

  <!-- Filters -->
  <div class="bg-white shadow-lg -mt-8 relative z-10">
    <div class="container-custom">
      <div class="bg-gradient-to-r from-cream to-white rounded-2xl shadow-xl p-6 md:p-8 border border-sand/20">
        <div class="flex items-center justify-between mb-6">
          <h2 class="text-xl font-serif font-bold text-charcoal flex items-center gap-2">
            <svg class="w-6 h-6 text-forest-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"/>
            </svg>
            Filter Sites
          </h2>
          <button
            @click="selectedCategory = ''; selectedRegion = ''; selectedUNESCO = ''; searchQuery = ''"
            class="text-sm text-forest-600 hover:text-forest-700 font-medium transition-colors flex items-center gap-1"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
            </svg>
            Clear All
          </button>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">

          <!-- Search -->
          <div>
            <label class="block text-sm font-semibold text-charcoal mb-2">Search</label>
            <input
              type="text"
              x-model="searchQuery"
              placeholder="Type to search..."
              class="w-full px-4 py-3 bg-white border-2 border-sand hover:border-forest-300 focus:border-forest-500 rounded-xl focus:ring-2 focus:ring-forest-200 transition-all shadow-sm"
            >
          </div>

          <!-- Category Filter -->
          <div>
            <label class="block text-sm font-semibold text-charcoal mb-2">Category</label>
            <select
              x-model="selectedCategory"
              class="w-full px-4 py-3 bg-white border-2 border-sand hover:border-forest-300 focus:border-forest-500 rounded-xl focus:ring-2 focus:ring-forest-200 transition-all shadow-sm cursor-pointer"
            >
              <option value="">All Categories</option>
              {{ range .Site.Taxonomies.categories.Alphabetical }}
                <option value="{{ .Page.Title }}">{{ .Page.Title | title }}</option>
              {{ end }}
            </select>
          </div>

          <!-- Region Filter -->
          <div>
            <label class="block text-sm font-semibold text-charcoal mb-2">Region</label>
            <select
              x-model="selectedRegion"
              class="w-full px-4 py-3 bg-white border-2 border-sand hover:border-forest-300 focus:border-forest-500 rounded-xl focus:ring-2 focus:ring-forest-200 transition-all shadow-sm cursor-pointer"
            >
              <option value="">All Regions</option>
              <option value="Baden-Württemberg">Baden-Württemberg</option>
              <option value="Bavaria">Bavaria</option>
              <option value="Berlin">Berlin</option>
              <option value="Brandenburg">Brandenburg</option>
              <option value="Bremen">Bremen</option>
              <option value="Hamburg">Hamburg</option>
              <option value="Hesse">Hesse</option>
              <option value="Lower Saxony">Lower Saxony</option>
              <option value="Mecklenburg-Vorpommern">Mecklenburg-Vorpommern</option>
              <option value="North Rhine-Westphalia">North Rhine-Westphalia</option>
              <option value="Rhineland-Palatinate">Rhineland-Palatinate</option>
              <option value="Saarland">Saarland</option>
              <option value="Saxony">Saxony</option>
              <option value="Saxony-Anhalt">Saxony-Anhalt</option>
              <option value="Schleswig-Holstein">Schleswig-Holstein</option>
              <option value="Thuringia">Thuringia</option>
            </select>
          </div>

          <!-- UNESCO Filter -->
          <div>
            <label class="block text-sm font-semibold text-charcoal mb-2">UNESCO Status</label>
            <select
              x-model="selectedUNESCO"
              class="w-full px-4 py-3 bg-white border-2 border-sand hover:border-forest-300 focus:border-forest-500 rounded-xl focus:ring-2 focus:ring-forest-200 transition-all shadow-sm cursor-pointer"
            >
              <option value="">All Sites</option>
              <option value="true">UNESCO Sites Only</option>
            </select>
          </div>

        </div>
      </div>
    </div>
  </div>

  <!-- Sites Grid -->
  <div class="container-custom py-12">

    <!-- Sites Grid -->
    {{ $paginator := .Paginate $allSites 24 }}
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" style="grid-auto-rows: 530px;">
      {{ range $paginator.Pages }}
        <div
          class="h-[530px] overflow-hidden"
          data-site-name="{{ .Params.site_name | lower }}"
          data-categories="{{ delimit .Params.categories "," }}"
          data-region="{{ .Params.region }}"
          data-unesco="{{ if in .Params.tags "unesco" }}true{{ else }}false{{ end }}"
          x-show="(searchQuery === '' || $el.dataset.siteName.includes(searchQuery.toLowerCase())) && (selectedCategory === '' || (',' + $el.dataset.categories.toLowerCase() + ',').includes(',' + selectedCategory.toLowerCase() + ',')) && (selectedRegion === '' || $el.dataset.region === selectedRegion) && (selectedUNESCO === '' || $el.dataset.unesco === selectedUNESCO)"
          x-transition:enter="transition ease-out duration-200"
          x-transition:enter-start="opacity-0 transform scale-95"
          x-transition:enter-end="opacity-100 transform scale-100"
        >
          {{ partial "site-card.html" . }}
        </div>
      {{ end }}
    </div>

    <!-- Pagination -->
    {{ if gt $paginator.TotalPages 1 }}
    <div class="mt-12 flex justify-center">
      <nav class="flex items-center gap-2" aria-label="Pagination">

        <!-- Previous Page -->
        {{ if $paginator.HasPrev }}
          <a href="{{ $paginator.Prev.URL }}" class="px-4 py-2 bg-white border-2 border-forest-500 text-forest-600 rounded-lg hover:bg-forest-50 transition-colors font-medium">
            ← Previous
          </a>
        {{ else }}
          <span class="px-4 py-2 bg-sand/50 border-2 border-sand text-stone rounded-lg cursor-not-allowed">
            ← Previous
          </span>
        {{ end }}

        <!-- Page Numbers -->
        <div class="flex items-center gap-1">
          {{ $currentPage := $paginator.PageNumber }}
          {{ $totalPages := $paginator.TotalPages }}

          {{ range $paginator.Pagers }}
            {{ $pageNum := .PageNumber }}
            {{ if or (eq $pageNum 1) (eq $pageNum $totalPages) (and (ge $pageNum (sub $currentPage 2)) (le $pageNum (add $currentPage 2))) }}
              {{ if eq $pageNum $currentPage }}
                <span class="px-4 py-2 bg-forest-600 text-white rounded-lg font-bold">
                  {{ $pageNum }}
                </span>
              {{ else }}
                <a href="{{ .URL }}" class="px-4 py-2 bg-white border-2 border-sand hover:border-forest-300 text-charcoal rounded-lg hover:bg-forest-50 transition-colors">
                  {{ $pageNum }}
                </a>
              {{ end }}
            {{ else if or (eq $pageNum (sub $currentPage 3)) (eq $pageNum (add $currentPage 3)) }}
              <span class="px-2 text-stone">...</span>
            {{ end }}
          {{ end }}
        </div>

        <!-- Next Page -->
        {{ if $paginator.HasNext }}
          <a href="{{ $paginator.Next.URL }}" class="px-4 py-2 bg-white border-2 border-forest-500 text-forest-600 rounded-lg hover:bg-forest-50 transition-colors font-medium">
            Next →
          </a>
        {{ else }}
          <span class="px-4 py-2 bg-sand/50 border-2 border-sand text-stone rounded-lg cursor-not-allowed">
            Next →
          </span>
        {{ end }}

      </nav>
    </div>
    {{ end }}

  </div>

</div>

{{ end }}
