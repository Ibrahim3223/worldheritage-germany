<a href="/sites/{{ .slug }}/" class="card group flex flex-col" style="height: 530px; max-height: 530px;" aria-label="View details about {{ .site.site_name }}, {{ .site.heritage_type }} in {{ .site.region }}">
  {{ with .site.images }}
    <div class="relative bg-sand h-64 overflow-hidden flex-shrink-0">
      <img
        srcset="{{ index . 0 }} 1920w,
                {{ index . 0 }} 1024w,
                {{ index . 0 }} 640w,
                {{ index . 0 }} 320w"
        sizes="(max-width: 640px) 100vw, (max-width: 1024px) 50vw, 400px"
        src="{{ index . 0 }}"
        alt="{{ $.site.site_name }} - {{ $.site.heritage_type }} in {{ $.site.region }}, Germany"
        class="w-full h-64 object-cover object-center"
        loading="lazy"
        decoding="async"
        width="400"
        height="225"
        onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22400%22 height=%22225%22%3E%3Crect fill=%22%23E8D5B7%22 width=%22400%22 height=%22225%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Arial, sans-serif%22 font-size=%2218%22 fill=%22%238B7E74%22%3E{{ $.site.site_name | truncate 30 }}%3C/text%3E%3C/svg%3E';"
      >
      {{ if in $.site.tags "unesco" }}
        <div class="absolute top-3 right-3 z-10">
          <span class="badge badge-unesco shadow-lg">UNESCO</span>
        </div>
      {{ end }}
    </div>
  {{ else }}
    <!-- Fallback if no image -->
    <div class="bg-gradient-to-br from-sand to-stone/20 h-64 flex items-center justify-center flex-shrink-0">
      <svg class="w-16 h-16 text-stone/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
      </svg>
    </div>
  {{ end }}

  <div class="card-body flex-grow flex flex-col">
    <h3 class="card-title group-hover:text-forest-600 transition-colors">
      {{ .site.site_name }}
    </h3>

    <p class="text-sm text-stone mb-3">üìç {{ .site.region }}</p>

    <p class="card-text line-clamp-3 overflow-hidden mb-4">
      {{ with .site.description }}
        {{ . | replaceRE "^#+\\s+" "" | replaceRE "\\*\\*" "" | replaceRE "##" "" | truncate 150 }}
      {{ end }}
    </p>

    <div class="flex-grow"></div>

    <div class="pt-4 border-t border-sand flex items-center justify-between flex-shrink-0">
      <span class="text-xs text-stone uppercase tracking-wide font-medium">
        {{ .site.heritage_type }}
      </span>
      <span class="text-forest-600 hover:text-forest-700 font-medium text-sm">
        Read more ‚Üí
      </span>
    </div>
  </div>
</a>
